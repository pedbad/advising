{% extends "core/base.html" %}

{% block title %}My Bookings - {{ SITE_NAME }}{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto">
  <div class="mb-6 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
    <div>
      <h1 class="text-3xl font-bold mb-2">My Bookings</h1>
      <p class="text-muted-foreground">
        {% if show_past %}
          Viewing your past meetings with students.
        {% else %}
          Viewing your upcoming meetings with students.
        {% endif %}
      </p>
    </div>
    <div class="flex flex-col gap-2 sm:flex-row sm:items-center">
      <a
        href="{% url 'users:teacher_bookings' %}{% if selected_date %}?date={{ selected_date }}{% endif %}"
        class="inline-flex items-center justify-center gap-2 h-9 px-4 py-2 rounded-md border border-input text-sm font-medium {% if not show_past %}bg-primary text-primary-foreground shadow-sm{% else %}bg-background hover:bg-accent hover:text-accent-foreground transition-colors{% endif %}"
      >
        Upcoming
      </a>
      <a
        href="{% url 'users:teacher_bookings' %}?show=past{% if selected_date %}&date={{ selected_date }}{% endif %}"
        class="inline-flex items-center justify-center gap-2 h-9 px-4 py-2 rounded-md border border-input text-sm font-medium {% if show_past %}bg-primary text-primary-foreground shadow-sm{% else %}bg-background hover:bg-accent hover:text-accent-foreground transition-colors{% endif %}"
      >
        Past
      </a>
    </div>
  </div>

  <c-card class="p-6 mb-6">
    <form method="get" class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
      <div class="flex items-center gap-2">
        <label for="date" class="text-sm font-medium">Filter by date:</label>
        <input
          type="date"
          id="date"
          name="date"
          value="{{ selected_date }}"
          {% if show_past %}
            max="{{ today|date:'Y-m-d' }}"
          {% else %}
            min="{{ today|date:'Y-m-d' }}"
          {% endif %}
          class="rounded-md border border-input bg-background px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-ring [color-scheme:light] dark:[color-scheme:dark]"
        >
        {% if show_past %}
          <input type="hidden" name="show" value="past">
        {% endif %}
        <button
          type="submit"
          class="inline-flex items-center gap-1 rounded-md bg-primary px-3 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition-colors"
        >
          Apply
        </button>
      </div>
      {% if selected_date %}
      <a
        href="{% if show_past %}?show=past{% else %}?{% endif %}"
        class="inline-flex items-center justify-center rounded-md border border-input px-3 py-2 text-sm font-medium hover:bg-accent hover:text-accent-foreground transition-colors"
      >
        Clear date
      </a>
      {% endif %}
    </form>
  </c-card>

  {% if bookings %}
    <div class="space-y-4">
      {% for booking in bookings %}
      <c-card class="p-5 space-y-3">
        <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
          <div>
            <p class="text-sm uppercase text-muted-foreground">Student</p>
            <p class="font-semibold">{{ booking.student.get_full_name|default:booking.student.email }}</p>
            <p class="text-xs text-muted-foreground">{{ booking.student.email }}</p>
          </div>
          <div>
            <p class="text-sm uppercase text-muted-foreground">Date</p>
            <p class="font-semibold">{{ booking.availability.date|date:"l, F j, Y" }}</p>
            <p class="text-xs text-muted-foreground">{{ booking.availability.start_time|time:"g:i A" }} – {{ booking.availability.end_time|time:"g:i A" }}</p>
          </div>
          <div class="flex items-center gap-2">
            {% if booking.availability.meeting_type == 'online' %}
              <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium bg-blue-100 text-blue-700">
                <span class="h-2 w-2 rounded-full bg-blue-500"></span>
                Online
              </span>
            {% elif booking.availability.meeting_type == 'in_person' %}
              <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium bg-green-100 text-green-700">
                <span class="h-2 w-2 rounded-full bg-green-500"></span>
                In-person
              </span>
            {% else %}
              <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium bg-purple-100 text-purple-700">
                <span class="h-2 w-2 rounded-full bg-purple-500"></span>
                Both
              </span>
            {% endif %}
          </div>
        </div>

        {% if booking.availability.message %}
        <div class="mt-2 w-full px-3 py-2 text-sm rounded-md border border-slate-200 bg-slate-50 dark:bg-slate-900/40 dark:border-slate-700">
          <span class="font-semibold">Your note:</span>
          {{ booking.availability.message }}
        </div>
        {% endif %}

        {% if booking.message %}
        <div class="mt-2 flex items-start gap-2 text-sm text-sky-900/90 dark:text-sky-100">
          {% include "core/icons/chat.html" with class="h-4 w-4 text-sky-500 dark:text-sky-300 mt-0.5" %}
          <span>
            <span class="font-semibold">Student note:</span>
            {{ booking.message }}
          </span>
        </div>
        {% endif %}
      </c-card>
      {% endfor %}
    </div>
  {% else %}
    <c-card class="p-12">
      <div class="text-center space-y-3">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-14 w-14 mx-auto text-muted-foreground opacity-60" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        <h3 class="text-xl font-semibold">
          {% if show_past %}No past bookings{% else %}No upcoming bookings{% endif %}
        </h3>
        <p class="text-muted-foreground">
          {% if show_past %}
            You have no recorded meetings for the selected range.
          {% else %}
            Students haven’t booked any upcoming slots with you yet.
          {% endif %}
        </p>
      </div>
    </c-card>
  {% endif %}
</div>
{% endblock %}

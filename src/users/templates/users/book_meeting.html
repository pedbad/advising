{% extends "core/base.html" %}

{% block title %}Book a Meeting - {{ SITE_NAME }}{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto">
  {# Header #}
  <div class="mb-6 flex items-center justify-between">
    <div>
      <h1 class="text-3xl font-bold mb-2">Book a Meeting</h1>
      <p class="text-lg text-muted-foreground">
        View available teacher slots and schedule your appointment
      </p>
    </div>
    <a
      href="{% url 'users:student_home' %}"
      class="inline-flex items-center justify-center gap-2 h-9 px-4 py-2 rounded-md border border-input bg-background shadow-xs hover:bg-accent hover:text-accent-foreground transition-colors text-sm font-medium"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
      </svg>
      Back to Dashboard
    </a>
  </div>

  {% if not has_completed_questionnaire %}
    {# Empty State - Questionnaire Required #}
    <c-card class="p-12">
      <div class="text-center max-w-md mx-auto">
        {# Sad Face Icon #}
        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-6 text-muted-foreground opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.182 16.318A4.486 4.486 0 0 0 12.016 15a4.486 4.486 0 0 0-3.198 1.318M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0ZM9.75 9.75c0 .414-.168.75-.375.75S9 10.164 9 9.75 9.168 9 9.375 9s.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Zm5.625 0c0 .414-.168.75-.375.75s-.375-.336-.375-.75.168-.75.375-.75.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Z" />
        </svg>

        <h2 class="text-2xl font-semibold mb-3">Pre-Appointment Questionnaire Required</h2>
        <p class="text-muted-foreground mb-6">
          Before you can view available meeting slots and book an appointment, you must first complete the pre-appointment questionnaire. This helps us understand your language learning goals and needs.
        </p>

        {# Action Buttons #}
        <div class="flex flex-col sm:flex-row gap-3 justify-center">
          <a
            href="{% url 'questionnaire:questionnaire' %}"
            class="inline-flex items-center justify-center gap-2 px-6 py-3 rounded-md text-sm font-medium bg-primary text-primary-foreground hover:opacity-90 transition-opacity"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v3.586l-1.293-1.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V8z" clip-rule="evenodd" />
            </svg>
            Complete Questionnaire
          </a>
          <a
            href="{% url 'users:student_home' %}"
            class="inline-flex items-center justify-center gap-2 px-6 py-3 rounded-md text-sm font-medium border border-input bg-background hover:bg-accent hover:text-accent-foreground transition-colors"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" />
            </svg>
            Back to Dashboard
          </a>
        </div>
      </div>
    </c-card>
  {% else %}
    {# Booking Interface #}
    {% if has_slots %}
      <div x-data="{
        groupBy: 'date',
        filter: 'all',
        selectedDate: '',
        showModal: false,
        selectedSlot: null,
        bookingMessage: '',
        allSlots: [
          {% for date, slots in availabilities_by_date.items %}
            {% for slot in slots %}
              {
                date: '{{ slot.date|date:"Y-m-d" }}',
                type: '{{ slot.meeting_type }}'
              }{% if not forloop.last or not forloop.parentloop.last %},{% endif %}
            {% endfor %}
          {% endfor %}
        ],
        get hasVisibleSlots() {
          return this.allSlots.some(slot => {
            const matchesDate = !this.selectedDate || this.selectedDate === slot.date;
            const matchesType = this.filter === 'all' || this.filter === slot.type;
            return matchesDate && matchesType;
          });
        },
        init() {
          this.$watch('selectedDate', value => {
            if (value) {
              this.groupBy = 'teacher';
            }
          });
        },
        clearDate() {
          this.selectedDate = '';
          this.groupBy = 'date';
        },
        clearAllFilters() {
          this.selectedDate = '';
          this.filter = 'all';
          this.groupBy = 'date';
        },
        openBookingModal(slotId, teacher, date, time, meetingType) {
          this.selectedSlot = {
            id: slotId,
            teacher: teacher,
            date: date,
            time: time,
            meetingType: meetingType
          };
          this.bookingMessage = '';
          this.showModal = true;
        },
        closeModal() {
          this.showModal = false;
          this.selectedSlot = null;
          this.bookingMessage = '';
        },
        async confirmBooking() {
          if (!this.selectedSlot) return;

          try {
            const formData = new FormData();
            formData.append('availability_id', this.selectedSlot.id);
            formData.append('message', this.bookingMessage);
            formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');

            const response = await fetch('{% url "users:book_meeting" %}', {
              method: 'POST',
              body: formData
            });

            const data = await response.json();

            if (data.success) {
              alert('Booking confirmed! Your appointment has been scheduled.');
              window.location.reload();
            } else {
              alert('Error: ' + (data.error || 'Unable to book this slot.'));
              this.closeModal();
            }
          } catch (error) {
            alert('Error: ' + error.message);
            this.closeModal();
          }
        }
      }">
        {# Controls: Filters on left, Date Picker on right #}
        <c-card class="mb-6 p-6">
          <div class="flex gap-6 items-start justify-between">
            {# Left Side - View Toggle and Filters #}
            <div class="flex-1 space-y-4">
              {# Group By Toggle #}
              <div x-show="!selectedDate">
                <label class="text-sm font-medium mb-2 block">View:</label>
                <div class="flex gap-2">
                  <button
                    @click="groupBy = 'date'"
                    :class="groupBy === 'date' ? 'bg-primary text-primary-foreground' : 'bg-background border border-input hover:bg-accent'"
                    class="px-4 py-2 rounded-md text-sm font-medium transition-colors"
                  >
                    Sort by Date/Time
                  </button>
                  <button
                    @click="groupBy = 'teacher'"
                    :class="groupBy === 'teacher' ? 'bg-primary text-primary-foreground' : 'bg-background border border-input hover:bg-accent'"
                    class="px-4 py-2 rounded-md text-sm font-medium transition-colors"
                  >
                    Group by Teacher
                  </button>
                </div>
              </div>

              {# Meeting Type Filters #}
              <div>
                <label class="text-sm font-medium mb-2 block">Filter by meeting type:</label>
                <div class="flex flex-wrap gap-2">
                  <button
                    @click="filter = 'all'"
                    :class="filter === 'all' ? 'bg-primary text-primary-foreground' : 'bg-background border border-input hover:bg-accent'"
                    class="px-4 py-2 rounded-md text-sm font-medium transition-colors"
                  >
                    All
                  </button>
                  <button
                    @click="filter = 'online'"
                    :class="filter === 'online' ? 'bg-blue-500 text-white border-blue-500' : 'bg-blue-50 text-blue-700 border-blue-300 hover:bg-blue-100'"
                    class="px-4 py-2 rounded-md text-sm font-medium transition-colors border-2"
                  >
                    Online
                  </button>
                  <button
                    @click="filter = 'in_person'"
                    :class="filter === 'in_person' ? 'bg-green-500 text-white border-green-500' : 'bg-green-50 text-green-700 border-green-300 hover:bg-green-100'"
                    class="px-4 py-2 rounded-md text-sm font-medium transition-colors border-2"
                  >
                    In-Person
                  </button>
                  <button
                    @click="filter = 'both'"
                    :class="filter === 'both' ? 'bg-purple-500 text-white border-purple-500' : 'bg-purple-50 text-purple-700 border-purple-300 hover:bg-purple-100'"
                    class="px-4 py-2 rounded-md text-sm font-medium transition-colors border-2"
                  >
                    Both
                  </button>
                </div>
              </div>
            </div>

            {# Right Side - Date Picker #}
            <div class="flex-shrink-0 w-72">
              <label class="text-sm font-medium mb-2 block">Select a specific date:</label>
              <div class="space-y-2">
                <input
                  type="date"
                  x-model="selectedDate"
                  min="{{ today|date:'Y-m-d' }}"
                  class="w-full px-3 py-2 rounded-md border border-input bg-card text-foreground text-sm focus:outline-none focus:ring-2 focus:ring-ring [color-scheme:light] dark:[color-scheme:dark]"
                >
                <button
                  x-show="selectedDate"
                  @click="clearDate()"
                  class="w-full px-4 py-2 rounded-md text-sm font-medium bg-background border border-input hover:bg-accent hover:text-accent-foreground transition-colors"
                >
                  Clear Date
                </button>
              </div>
            </div>
          </div>
        </c-card>

        {# Sorted by Date View #}
        <div x-show="groupBy === 'date'" x-transition>
          {% for date, slots in availabilities_by_date.items %}
            <c-card
              class="mb-4"
              data-date-card="{{ date|date:'Y-m-d' }}"
              x-show="!selectedDate || selectedDate === '{{ date|date:"Y-m-d" }}'"
            >
              <div class="border-b bg-muted/30 px-6 py-4">
                <h2 class="text-xl font-semibold">
                  {% if date == today %}
                    Today
                  {% elif date == tomorrow %}
                    Tomorrow
                  {% else %}
                    {{ date|date:"l, F j, Y" }}
                  {% endif %}
                </h2>
              </div>
              <div class="p-6">
                <div class="space-y-3">
                  {% for slot in slots %}
                    <div
                      class="flex items-center gap-4 p-4 rounded-lg border hover:bg-accent/50 transition-colors"
                      data-meeting-type="{{ slot.meeting_type }}"
                      x-show="filter === 'all' || filter === '{{ slot.meeting_type }}'"
                    >
                      {# Time #}
                      <div class="flex-shrink-0 w-40">
                        <div class="font-medium">{{ slot.start_time|time:"g:i A" }} - {{ slot.end_time|time:"g:i A" }}</div>
                      </div>

                      {# Teacher Info #}
                      <div class="flex-1">
                        <div class="font-medium">{{ slot.teacher.get_full_name|default:slot.teacher.email }}</div>
                        <div class="text-sm text-muted-foreground">{{ slot.teacher.email }}</div>
                      </div>

                      {# Meeting Type Badge #}
                      <div class="flex-shrink-0">
                        {% if slot.meeting_type == 'online' %}
                          <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium bg-blue-100 text-blue-700">
                            <div class="h-2 w-2 rounded-full bg-blue-500"></div>
                            Online
                          </span>
                        {% elif slot.meeting_type == 'in_person' %}
                          <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium bg-green-100 text-green-700">
                            <div class="h-2 w-2 rounded-full bg-green-500"></div>
                            In-Person
                          </span>
                        {% elif slot.meeting_type == 'both' %}
                          <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium bg-purple-100 text-purple-700">
                            <div class="h-2 w-2 rounded-full bg-purple-500"></div>
                            Both
                          </span>
                        {% endif %}
                      </div>

                      {# Message (if present) #}
                      {% if slot.message %}
                        <div class="flex-shrink-0">
                          <div class="px-3 py-1.5 text-xs rounded-md bg-amber-50 border border-amber-200 text-amber-900 max-w-xs">
                            <span class="font-medium">Note:</span> {{ slot.message }}
                          </div>
                        </div>
                      {% endif %}

                      {# Book Button #}
                      <div class="flex-shrink-0">
                        <button
                          @click="openBookingModal({{ slot.id }}, '{{ slot.teacher.get_full_name|default:slot.teacher.email }}', '{{ date|date:"l, F j, Y" }}', '{{ slot.start_time|time:"g:i A" }} - {{ slot.end_time|time:"g:i A" }}', '{{ slot.get_meeting_type_display }}')"
                          class="inline-flex items-center justify-center gap-2 px-4 py-2 rounded-md text-sm font-medium bg-primary text-primary-foreground hover:opacity-90 transition-opacity"
                        >
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
                          </svg>
                          Book
                        </button>
                      </div>
                    </div>
                  {% endfor %}
                </div>
              </div>
            </c-card>
          {% endfor %}
        </div>

        {# Grouped by Teacher View #}
        <div x-show="groupBy === 'teacher'" x-transition style="display: none;">
          {% for teacher_data in availabilities_by_teacher %}
            <c-card
              class="mb-4"
              data-teacher-card="true"
              data-teacher-dates="{% for slot in teacher_data.slots %}{{ slot.date|date:'Y-m-d' }}{% if not forloop.last %},{% endif %}{% endfor %}"
              data-teacher-types="{% for slot in teacher_data.slots %}{{ slot.meeting_type }}{% if not forloop.last %},{% endif %}{% endfor %}"
              x-show="(() => {
                const dates = $el.dataset.teacherDates.split(',');
                const types = $el.dataset.teacherTypes.split(',');

                for (let i = 0; i < dates.length; i++) {
                  const matchesDate = !selectedDate || selectedDate === dates[i];
                  const matchesType = filter === 'all' || filter === types[i];
                  if (matchesDate && matchesType) return true;
                }
                return false;
              })()"
            >
              <div class="border-b bg-muted/30 px-6 py-4">
                <h2 class="text-xl font-semibold">{{ teacher_data.teacher.get_full_name|default:teacher_data.teacher.email }}</h2>
                <p class="text-sm text-muted-foreground">{{ teacher_data.teacher.email }}</p>
              </div>
              <div class="p-6">
                <div class="space-y-3">
                  {% for slot in teacher_data.slots %}
                    <div
                      class="flex items-center gap-4 p-4 rounded-lg border hover:bg-accent/50 transition-colors"
                      data-meeting-type="{{ slot.meeting_type }}"
                      data-slot-date="{{ slot.date|date:'Y-m-d' }}"
                      x-show="(filter === 'all' || filter === '{{ slot.meeting_type }}') && (!selectedDate || selectedDate === '{{ slot.date|date:"Y-m-d" }}')"
                    >
                      {# Date #}
                      <div class="flex-shrink-0 w-48">
                        <div class="font-medium">{{ slot.date|date:"l, M j, Y" }}</div>
                      </div>

                      {# Time #}
                      <div class="flex-shrink-0 w-40">
                        <div class="font-medium">{{ slot.start_time|time:"g:i A" }} - {{ slot.end_time|time:"g:i A" }}</div>
                      </div>

                      {# Meeting Type Badge #}
                      <div class="flex-shrink-0">
                        {% if slot.meeting_type == 'online' %}
                          <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium bg-blue-100 text-blue-700">
                            <div class="h-2 w-2 rounded-full bg-blue-500"></div>
                            Online
                          </span>
                        {% elif slot.meeting_type == 'in_person' %}
                          <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium bg-green-100 text-green-700">
                            <div class="h-2 w-2 rounded-full bg-green-500"></div>
                            In-Person
                          </span>
                        {% elif slot.meeting_type == 'both' %}
                          <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium bg-purple-100 text-purple-700">
                            <div class="h-2 w-2 rounded-full bg-purple-500"></div>
                            Both
                          </span>
                        {% endif %}
                      </div>

                      {# Message (if present) #}
                      {% if slot.message %}
                        <div class="flex-1">
                          <div class="px-3 py-1.5 text-xs rounded-md bg-amber-50 border border-amber-200 text-amber-900">
                            <span class="font-medium">Note:</span> {{ slot.message }}
                          </div>
                        </div>
                      {% endif %}

                      {# Book Button #}
                      <div class="flex-shrink-0">
                        <button
                          @click="openBookingModal({{ slot.id }}, '{{ teacher_data.teacher.get_full_name|default:teacher_data.teacher.email }}', '{{ slot.date|date:"l, F j, Y" }}', '{{ slot.start_time|time:"g:i A" }} - {{ slot.end_time|time:"g:i A" }}', '{{ slot.get_meeting_type_display }}')"
                          class="inline-flex items-center justify-center gap-2 px-4 py-2 rounded-md text-sm font-medium bg-primary text-primary-foreground hover:opacity-90 transition-opacity"
                        >
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
                          </svg>
                          Book
                        </button>
                      </div>
                    </div>
                  {% endfor %}
                </div>
              </div>
            </c-card>
          {% endfor %}
        </div>

        {# No Results Empty State #}
        <div
          x-show="!hasVisibleSlots"
          x-transition
        >
          <c-card class="p-12">
            <div class="text-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-4 text-muted-foreground opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <h3 class="text-xl font-semibold mb-2">No Results Found</h3>
              <p class="text-muted-foreground mb-6">
                No availability slots match your current filters.
                <span x-show="selectedDate">
                  Try selecting a different date or clearing your filters.
                </span>
              </p>
              <button
                @click="clearAllFilters()"
                class="inline-flex items-center justify-center gap-2 px-6 py-3 rounded-md text-sm font-medium bg-primary text-primary-foreground hover:opacity-90 transition-opacity"
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
                </svg>
                Clear All Filters
              </button>
            </div>
          </c-card>
        </div>

        {# Booking Modal #}
        <div
          x-show="showModal"
          x-transition:enter="transition ease-out duration-300"
          x-transition:enter-start="opacity-0"
          x-transition:enter-end="opacity-100"
          x-transition:leave="transition ease-in duration-200"
          x-transition:leave-start="opacity-100"
          x-transition:leave-end="opacity-0"
          class="fixed inset-0 z-50 overflow-y-auto"
          style="display: none;"
          @keydown.escape.window="closeModal()"
        >
          {# Backdrop #}
          <div class="fixed inset-0 bg-black bg-opacity-50 transition-opacity" @click="closeModal()"></div>

          {# Modal Content #}
          <div class="flex min-h-full items-center justify-center p-4">
            <div
              class="relative bg-card rounded-lg shadow-xl max-w-lg w-full p-6"
              x-transition:enter="transition ease-out duration-300"
              x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
              x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
              x-transition:leave="transition ease-in duration-200"
              x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
              x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
              @click.stop
            >
              {# Modal Header #}
              <div class="flex items-start justify-between mb-4">
                <h3 class="text-2xl font-semibold">Confirm Booking</h3>
                <button
                  @click="closeModal()"
                  class="text-muted-foreground hover:text-foreground transition-colors"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>
              </div>

              {# Modal Body #}
              <div class="space-y-4">
                <div class="p-4 bg-muted/30 rounded-lg space-y-2">
                  <div class="flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-muted-foreground" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                    </svg>
                    <div>
                      <span class="text-sm text-muted-foreground">Teacher:</span>
                      <span class="font-medium ml-2" x-text="selectedSlot?.teacher"></span>
                    </div>
                  </div>
                  <div class="flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-muted-foreground" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                    </svg>
                    <div>
                      <span class="text-sm text-muted-foreground">Date:</span>
                      <span class="font-medium ml-2" x-text="selectedSlot?.date"></span>
                    </div>
                  </div>
                  <div class="flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-muted-foreground" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
                    </svg>
                    <div>
                      <span class="text-sm text-muted-foreground">Time:</span>
                      <span class="font-medium ml-2" x-text="selectedSlot?.time"></span>
                    </div>
                  </div>
                  <div class="flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-muted-foreground" viewBox="0 0 20 20" fill="currentColor">
                      <path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z" />
                    </svg>
                    <div>
                      <span class="text-sm text-muted-foreground">Type:</span>
                      <span class="font-medium ml-2" x-text="selectedSlot?.meetingType"></span>
                    </div>
                  </div>
                </div>

                <div>
                  <label for="booking-message" class="block text-sm font-medium mb-2">
                    Message to Advisor (Optional)
                  </label>
                  <textarea
                    id="booking-message"
                    x-model="bookingMessage"
                    rows="4"
                    class="w-full px-3 py-2 rounded-md border border-input bg-background text-foreground text-sm focus:outline-none focus:ring-2 focus:ring-ring resize-none"
                    placeholder="Let your advisor know if you have any specific topics or questions you'd like to discuss..."
                  ></textarea>
                </div>
              </div>

              {# Modal Footer #}
              <div class="flex gap-3 mt-6">
                <button
                  @click="closeModal()"
                  class="flex-1 px-4 py-2 rounded-md text-sm font-medium border border-input bg-background hover:bg-accent hover:text-accent-foreground transition-colors"
                >
                  Cancel
                </button>
                <button
                  @click="confirmBooking()"
                  class="flex-1 px-4 py-2 rounded-md text-sm font-medium bg-primary text-primary-foreground hover:opacity-90 transition-opacity"
                >
                  Confirm Booking
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    {% else %}
      {# Empty State - No Slots Available #}
      <c-card class="p-12">
        <div class="text-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-4 text-muted-foreground opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
          <h3 class="text-xl font-semibold mb-2">No Available Slots</h3>
          <p class="text-muted-foreground">There are no available meeting slots at the moment. Please check back later.</p>
        </div>
      </c-card>
    {% endif %}
  {% endif %}
</div>
{% endblock %}
